import{t as B}from"./tableHandle-d6735526.js";import{s as w,i as L}from"./index-a7709a82.js";import{f as I,r as R,e as j,p as V,a as s,o as C,c as v,d as t,w as o,u,b as g,j as _,F,g as H}from"./index-f68cef2b.js";import"./http-fbdac65a.js";const T={class:"absent"},O=g("h1",null,"缺勤管理",-1),$={class:"btn-container"},q=g("div",{id:"main",class:"chart"},null,-1),X={__name:"Absent",setup(G){I(m);const x=[{name:"缺席时间",key:"time",width:100},{name:"学号",key:"student.no",width:100},{name:"身份证号",key:"student.idCard",width:200},{name:"姓名",key:"student.studentName",width:100},{name:"学院",key:"student.college",width:150},{name:"班级",key:"student.className",width:150},{name:"年级",key:"student.grade",width:100},{name:"性别",key:"student.sex",width:100},{name:"缺勤",key:"student.absentText",width:100},{name:"邮箱",key:"student.email",width:100},{name:"电话",key:"student.phone",width:100},{name:"宿舍楼",key:"student.building",width:100},{name:"宿舍",key:"student.dorm",width:100},{name:"电费",key:"student.money",width:100}],l=R({studentName:"",no:"",college:"",className:"",building:"",absent:"",timeRange:[]}),{pageSize:h,pageNum:y,total:b,handleCurrentChange:N,handleSizeChange:z,reset:Y}=B(m,l),f=j([]);async function m(){const d=await w.getAbsentList({...l,pageSize:h.value,pageNum:y.value}),{data:e}=d;e.list.forEach(n=>{n.time=V(n.time).format("YYYY-MM-DD")}),f.value=e.list,b.value=e.total,r=[],p=[],e.count.forEach(n=>{r.push(V(n.time).format("YYYY-MM-DD")),p.push(n.count)}),A()}let r=[],p=[];function A(){const d=document.getElementById("main"),e=L(d);let n;n={xAxis:{type:"category",data:r},yAxis:{type:"value"},series:[{data:p,type:"line"}]},n&&e.setOption(n)}async function D(d){const e={stuId:d.stuId,time:d.time},n=await w.cancelAbsent(e);ElMessage({message:n.msg,type:"success"}),m()}return(d,e)=>{const n=s("el-input"),i=s("el-form-item"),M=s("el-date-picker"),c=s("el-button"),U=s("el-form"),k=s("el-table-column"),E=s("el-table"),S=s("el-pagination");return C(),v("div",T,[O,t(U,{inline:!0,"label-width":"70"},{default:o(()=>[t(i,{label:"学院"},{default:o(()=>[t(n,{modelValue:l.college,"onUpdate:modelValue":e[0]||(e[0]=a=>l.college=a),placeholder:"学院"},null,8,["modelValue"])]),_:1}),t(i,{label:"班级"},{default:o(()=>[t(n,{modelValue:l.className,"onUpdate:modelValue":e[1]||(e[1]=a=>l.className=a),placeholder:"班级"},null,8,["modelValue"])]),_:1}),t(i,{label:"学号"},{default:o(()=>[t(n,{modelValue:l.no,"onUpdate:modelValue":e[2]||(e[2]=a=>l.no=a),placeholder:"学号"},null,8,["modelValue"])]),_:1}),t(i,{label:"姓名"},{default:o(()=>[t(n,{modelValue:l.studentName,"onUpdate:modelValue":e[3]||(e[3]=a=>l.studentName=a),placeholder:"姓名"},null,8,["modelValue"])]),_:1}),t(i,{label:"宿舍楼"},{default:o(()=>[t(n,{modelValue:l.building,"onUpdate:modelValue":e[4]||(e[4]=a=>l.building=a),placeholder:"宿舍楼"},null,8,["modelValue"])]),_:1}),t(i,{label:"缺席时间"},{default:o(()=>[t(M,{modelValue:l.timeRange,"onUpdate:modelValue":e[5]||(e[5]=a=>l.timeRange=a),type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue"])]),_:1}),g("div",$,[t(c,{type:"primary",onClick:m},{default:o(()=>[_("查询")]),_:1}),t(c,{onClick:u(Y)},{default:o(()=>[_("重置")]),_:1},8,["onClick"])])]),_:1}),t(E,{data:f.value,style:{width:"100%","margin-bottom":"30px"},"max-height":"600px"},{default:o(()=>[(C(),v(F,null,H(x,a=>t(k,{key:a.key,prop:a.key,label:a.name,"min-width":a.width},null,8,["prop","label","min-width"])),64)),t(k,{label:"操作","min-width":"150",fixed:"right"},{default:o(a=>[t(c,{size:"small",type:"primary",onClick:J=>D(a.row)},{default:o(()=>[_("取消缺勤")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),t(S,{background:"",layout:"prev, pager, next",total:u(b),"current-page":u(y),"page-size":u(h),onCurrentChange:u(N),onSizeChange:u(z)},null,8,["total","current-page","page-size","onCurrentChange","onSizeChange"]),q])}}};export{X as default};
